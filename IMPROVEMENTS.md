# Предложения по улучшению VK SOSA

Список улучшений по бэкенду, фронтенду, безопасности, тестам и документации.

---

## Бэкенд

### Надёжность и мониторинг

| Улучшение | Описание | Сложность |
|-----------|----------|-----------|
| **Health endpoint** | Добавить `GET /api/health` или `GET /health` (проверка БД, версия). Нужен для load balancer, systemd `ExecStartPost`, мониторинга. | Низкая |
| **Структурированное логирование** | В продакшене писать логи в JSON (уровень, время, request_id, user_id). Упрощает сбор в ELK/Loki. | Средняя |
| **Request ID** | Генерировать `X-Request-ID` в middleware и прокидывать в логи и при необходимости в ответе. | Низкая |

### Безопасность

| Улучшение | Описание | Сложность |
|-----------|----------|-----------|
| **Rate limiting** | Ограничение частоты запросов (например через `slowapi`): отдельно для `/auth/login`, `/auth/register` и общий лимит на API. Защита от брутфорса и DDoS. | Средняя |
| **JWT в продакшене** | При `JWT_SECRET=dev_secret_change_me` в production — логировать предупреждение или не запускать приложение. | Низкая |
| **CORS** | Не использовать `allow_origins=["*"]` в продакшене — задавать явный список доменов через `CORS_ORIGINS`. | Низкая |
| **Заголовки безопасности** | Добавить middleware с заголовками: `X-Content-Type-Options: nosniff`, `X-Frame-Options: DENY` (или SAMEORIGIN), при HTTPS — `Strict-Transport-Security`. | Низкая |
| **Лимит размера загрузок** | Ограничить размер тела запроса и размер загружаемых файлов (аватар, обложка), проверять content-type (только изображения). | Низкая |

### Архитектура и код

| Улучшение | Описание | Сложность |
|-----------|----------|-----------|
| **Разбить server.py** | Вынести маршруты в отдельные модули (например `routers/auth.py`, `routers/users.py`, `routers/posts.py`), модели — в `models/`, зависимости (get_current_user_id и т.д.) — в `deps.py`. Файл ~2500 строк сложно сопровождать. | Средняя |
| **Ограничение пагинации** | Для параметров `limit`/`skip` задать максимум (например `limit <= 100`) и значение по умолчанию, чтобы нельзя было запрашивать тысячи записей за раз. | Низкая |
| **Refresh token** | Опционально: пара access (короткий) + refresh (длинный) токен, эндпоинт `/api/auth/refresh` для продления сессии без повторного логина. | Средняя |

### База данных

| Улучшение | Описание | Сложность |
|-----------|----------|-----------|
| **Индексы** | Проверить и при необходимости добавить индексы под частые запросы: `users(username)`, `users(email)`, `posts(user_id, created_at)`, `messages(conversation_id, created_at)`, `friendships(user_id, status)` и т.д. | Низкая |
| **Пул подключений** | В `database.py` для PostgreSQL задать `min_size`, `max_size` под нагрузку; при необходимости таймауты на команды. | Низкая |

---

## Фронтенд

### Надёжность и UX

| Улучшение | Описание | Сложность |
|-----------|----------|-----------|
| **Error Boundary** | React Error Boundary на уровне маршрутов или всего приложения: при падении рендера показывать заглушку и кнопку «Обновить», не белый экран. | Низкая |
| **Глобальная обработка ошибок API** | Единый перехватчик (например в axios) для 5xx/сетевых ошибок: показывать toast или баннер «Временные неполадки», опция повтора. | Низкая |
| **Состояния загрузки** | Единый подход к loading/skeleton на страницах (лента, профиль, список друзей), чтобы не было «пустого» контента без индикатора. | Средняя |
| **Оптимистичные обновления** | Для лайков, комментариев, заявок в друзья: сразу обновлять UI, при ошибке откатывать и показывать сообщение. | Средняя |

### Производительность и доступность

| Улучшение | Описание | Сложность |
|-----------|----------|-----------|
| **Lazy loading изображений** | Для аватаров и фото в ленте/медиа использовать `loading="lazy"` или Intersection Observer, плейсхолдеры до загрузки. | Низкая |
| **Код-сплитинг** | React.lazy + Suspense для тяжёлых страниц (например админка, медиа), чтобы уменьшить начальный бандл. | Низкая |
| **Доступность (a11y)** | Проверить фокус при открытии модалок, aria-labels у кнопок-иконок, контраст, навигация с клавиатуры. | Средняя |
| **Валидация окружения** | При старте приложения проверять, что `REACT_APP_BACKEND_URL` задан (или пустой для относительного API) и что бэкенд доступен (опционально — запрос к /health). | Низкая |

---

## Тестирование

| Улучшение | Описание | Сложность |
|-----------|----------|-----------|
| **Тесты бэкенда** | pytest: smoke-тесты для `GET /api/health`, `POST /auth/register`, `POST /auth/login`, `GET /users/me` с токеном. Можно с SQLite in-memory. | Средняя |
| **Тесты фронтенда** | React Testing Library для критичных компонентов (логин, форма поста, отображение ленты). | Средняя |
| **E2E** | Опционально: Playwright/Cypress — сценарий «регистрация → вход → пост в ленту». | Высокая |

---

## Документация и деплой

| Улучшение | Описание | Сложность |
|-----------|----------|-----------|
| **BACKEND_API_DOCUMENTATION** | Добавить раздел «Коды ошибок» (таблица 400/401/403/404/422/500), при появлении rate limit — описать лимиты. Указать рекомендуемые значения пагинации (limit/skip). | Низкая |
| **README** | Секция «Дальнейшие улучшения» со ссылкой на IMPROVEMENTS.md; при необходимости — краткий Contributing. | Низкая |
| **Health в деплое** | В systemd-юнитах или скриптах деплоя использовать `curl -f http://127.0.0.1:8001/api/health` (после появления эндпоинта) для проверки после старта. | Низкая |
| **Версионирование API** | При появлении несовместимых изменений — префикс версии в пути (`/api/v1/`) и описание в документации. | Средняя |

---

## Быстрые победы (можно сделать первыми)

1. **Health endpoint** — один маршрут, проверка БД (например `SELECT 1`).
2. **Проверка JWT_SECRET** в production и предупреждение в логах.
3. **Максимальный limit** в эндпоинтах с пагинацией (например 100).
4. **React Error Boundary** — один компонент и обёртка вокруг основного дерева.
5. **Security headers** — один middleware в FastAPI.
6. **Раздел «Коды ошибок»** в BACKEND_API_DOCUMENTATION.md.

---

*Документ можно дополнять по мере реализации пунктов или появления новых идей.*
